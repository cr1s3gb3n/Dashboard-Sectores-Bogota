<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard EAAB-Uniandes</title>

  <!-- MapLibre -->
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.css">
  <script src="https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"></script>

  <!-- Favicon (evita 404 en consola) -->
  <link rel="icon" href="assets/img/logo_andes.png" type="image/png">

  <!-- Estilos -->
  <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>

  <!-- Loading overlay -->
  <div id="loading-overlay">
    <div class="loader-box">
      <div class="spinner" aria-hidden="true"></div>
      <div class="loader-text">Cargando DashBoard EAAB - Uniandes</div>
      <div class="loader-subtext">Cargando datos...</div>
    </div>
  </div>

  <!-- LOGOS -->
  <div class="logo-container">
    <div class="logo-box">
      <img src="assets/img/logo_andes.png" class="cine-logo">
      <img src="assets/img/logo_eaab.jpg" class="cine-logo">
    </div>
  </div>

  <div id="layout">

    <!-- MAPA -->
    <div id="map"></div>

    <!-- PANEL LATERAL -->
    <aside id="panel" class="panel-hidden">
      <div class="panel-inner">
      <h3 id="titulo-panel">
        <button id="coropletico-toggle-btn" class="coropletico-btn" aria-expanded="true" aria-controls="coropletico-opciones">Mapa Coroplético</button>
      </h3>

      <!-- OPCIONES -->
      <div id="coropletico-opciones">
        <h4>Sombrear por indicador</h4>

        <div class="legend-row" data-indicador="Submedición">
          <div class="legend-dot" style="background:#2b8cbe"></div> Submedición
        </div>

        <div class="legend-row" data-indicador="Errores / Fallas de catastro">
          <div class="legend-dot" style="background:#fdae61"></div> Errores / Fallas de catastro
        </div>

        <div class="legend-row" data-indicador="Consumo no autorizado">
          <div class="legend-dot" style="background:#1a9850"></div> Consumo no autorizado
        </div>

        <div class="legend-row" data-indicador="Fugas técnicas">
          <div class="legend-dot" style="background:#d73027"></div> Fugas técnicas
        </div>

        <div class="legend-row" data-indicador="AMSI">
          <div class="legend-dot" style="background:#6a51a3"></div> AMSI
        </div>
      </div>

      <div id="sector-box">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
          <div>
            <label>Sector seleccionado</label>
            <div id="sector-actual">Ninguno</div>
          </div>
          <div style="display:flex;align-items:center;gap:6px;">
            <button id="sector-toggle" aria-expanded="false" style="background:#f0f6fb;border:1px solid #d7eaf8;padding:6px;border-radius:6px;cursor:pointer;">
              <svg width="14" height="14" viewBox="0 0 20 20"><polyline points="6 8 10 12 14 8" fill="none" stroke="#0077c8" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
          </div>
        </div>
        <div id="sector-dropdown" class="hidden" style="margin-top:8px;">
          <ul id="sector-list" style="list-style:none;margin:0;padding:6px;border:1px solid #eee;border-radius:6px;max-height:220px;overflow:auto;background:#fff;"></ul>
        </div>
      </div>

      <!-- TABS -->
      <div id="tabs">
        <button class="tab active" data-tab="info">Información</button>
        <button class="tab" data-tab="geo">Geográfico</button>
      </div>

      <div id="tab-info" class="tab-content active">
        <div class="kpi" data-key="VE (Mm³/año)">
          <div class="kpi-row">
            <label>VE (Mm³/año)</label>
            <div class="kpi-value" id="kpi-ve">--</div>
          </div>
          <div class="kpi-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="kpi-fill" id="kpi-fill-ve" style="width:0%"></div>
          </div>
        </div>

        <div class="kpi" data-key="Pérdidas Totales (Mm³/año)">
          <div class="kpi-row">
            <label>Pérdidas Totales (%)</label>
            <div class="kpi-value" id="kpi-pt">--</div>
          </div>
          <div class="kpi-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="kpi-fill" id="kpi-fill-pt" style="width:0%"></div>
          </div>
        </div>

        <div class="kpi" data-key="Pérdidas Aparentes (Mm³/año)">
          <div class="kpi-row">
            <label>Pérdidas Aparentes</label>
            <div class="kpi-value" id="kpi-pa">--</div>
          </div>
          <div class="kpi-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="kpi-fill" id="kpi-fill-pa" style="width:0%"></div>
          </div>
        </div>

        <div class="kpi" data-key="Pérdidas Técnicas (Mm³/año)">
          <div class="kpi-row">
            <label>Pérdidas Técnicas</label>
            <div class="kpi-value" id="kpi-pr">--</div>
          </div>
          <div class="kpi-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="kpi-fill" id="kpi-fill-pr" style="width:0%"></div>
          </div>
        </div>

        <div class="kpi" data-key="AMSI">
          <div class="kpi-row">
            <label>AMSI</label>
            <div class="kpi-value" id="kpi-amsi">--</div>
          </div>
          <div class="kpi-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="kpi-fill" id="kpi-fill-amsi" style="width:0%"></div>
          </div>
        </div>

        <div class="kpi" data-key="UARL">
          <div class="kpi-row">
            <label>UARL</label>
            <div class="kpi-value" id="kpi-uarl">--</div>
          </div>
          <div class="kpi-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="kpi-fill" id="kpi-fill-uarl" style="width:0%"></div>
          </div>
        </div>

        <div class="kpi" data-key="ILI">
          <div class="kpi-row">
            <label>ILI</label>
            <div class="kpi-value" id="kpi-ili">--</div>
          </div>
          <div class="kpi-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="kpi-fill" id="kpi-fill-ili" style="width:0%"></div>
          </div>
        </div>

        <div class="kpi" data-key="IPUF">
          <div class="kpi-row">
            <label>IPUF</label>
            <div class="kpi-value" id="kpi-ipuf">--</div>
          </div>
          <div class="kpi-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="kpi-fill" id="kpi-fill-ipuf" style="width:0%"></div>
          </div>
        </div>
      </div>

      <div id="tab-geo" class="tab-content">
        <div class="geo-charts">
          <div class="geo-charts-top">
            <label>(VE)</label>
            <div style="height:320px; padding:8px; background:#fff; border-radius:6px; box-shadow:0 1px 2px rgba(0,0,0,0.06);">
              <canvas id="stacked-bars-total" style="width:100%;height:100%;"></canvas>
            </div>
          </div>

          <div class="geo-charts-bottom" style="margin-top:12px;">
            <label>Distribución de pérdidas y eventos (pie)</label>
            <div style="height:260px; padding:8px; background:#fff; border-radius:6px; box-shadow:0 1px 2px rgba(0,0,0,0.06);">
              <canvas id="pie-fugas" style="width:100%;height:100%;"></canvas>
            </div>
          </div>
        </div>
      </div>
    </aside>

  </div>

  <!-- JS -->
  <script src="assets/js/data.js"></script>
  <script src="assets/js/popup.js"></script>
  <script src="assets/js/app.js"></script>
  <!-- Chart.js (UMD) required by charts.js which uses global `Chart` -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <!-- tabs.js imports ./charts.js so must be loaded as a module -->
  <script type="module" src="assets/js/tabs.js"></script>
  <script src="assets/js/shading3d.js" type="module"></script>
  <script src="assets/js/map.js" type="module"></script>

</body>
</html>
